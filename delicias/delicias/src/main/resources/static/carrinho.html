<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delicias Fer Lopes â€” Carrinho</title>

  <!-- Importa o arquivo CSS principal -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Fonte Poppins do Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>

<!-- ======= CABEÃ‡ALHO ======= -->
<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <!-- Logo da doceria -->
      <img src="img/delicias da fer.png" alt="Delicias da Fer Lopes" class="logo">
      <div class="brand-text">
        <h1>Delicias</h1>
        <small>Fer Lopes</small>
      </div>
    </div>

    <!-- Menu de navegaÃ§Ã£o -->
    <nav class="main-nav">
      <a class="nav-link" href="index.html">InÃ­cio</a>
      <a class="nav-link" href="produtos.html">Produtos</a>
      <a class="nav-link" href="sobre.html">Sobre</a>
      <a class="nav-link active" href="carrinho.html">Carrinho</a>
    </nav>

    <!-- AÃ§Ãµes do cabeÃ§alho (telefone e Ã­cone do carrinho) -->
    <div class="header-actions">
      <a class="phone" href="tel:+5511999999999">ðŸ“ž (15) 99717-2394</a>
      <a class="cart-link" href="carrinho.html">ðŸ›’ <span id="cart-count-badge">0</span></a>
    </div>
  </div>
</header>

<!-- ======= SEÃ‡ÃƒO DE TÃTULO ======= -->
<section class="section hero small-hero">
  <div class="container">
    <h2 class="section-title">Carrinho</h2>
    <p class="section-desc">Confira seus produtos selecionados, remova itens ou finalize a compra pelo WhatsApp.</p>
  </div>
</section>

<!-- ======= CONTEÃšDO PRINCIPAL ======= -->
<main class="container produtos-page">
  <!-- Onde os produtos do carrinho serÃ£o listados -->
  <div id="carrinhoGrid" class="grid-cardapio"></div>

  <!-- RodapÃ© do carrinho com o total e o botÃ£o de compra -->
  <div class="carrinho-footer">
    <h3>Total: R$ <span id="totalValue">0.00</span></h3>
    <a class="btn primary" id="finalizarCompraBtn" href="#" target="_blank">Finalizar Compra</a>
  </div>
</main>

<!-- ======= RODAPÃ‰ ======= -->
<footer class="site-footer">
  <div class="container footer-inner">
    <div>Â© <span id="year"></span> Delicias Fer Lopes â€” Todos os direitos reservados.</div>
    <div>ðŸ“ž (15) 99717-2394 â€¢ Sorocaba</div>
  </div>
</footer>

<!-- ======= SCRIPT DO CARRINHO ======= -->
<script>
// Seleciona os elementos do HTML que serÃ£o manipulados
const carrinhoGrid = document.getElementById("carrinhoGrid");
const cartCountBadge = document.getElementById("cart-count-badge");
const totalValue = document.getElementById("totalValue");
const finalizarCompraBtn = document.getElementById("finalizarCompraBtn");

// ---------- FunÃ§Ãµes utilitÃ¡rias ----------

// Pega o carrinho salvo no localStorage (ou retorna vazio)
function getCart() {
  return JSON.parse(localStorage.getItem("carrinho")) || [];
}

// Atualiza o carrinho no localStorage
function setCart(cart) {
  localStorage.setItem("carrinho", JSON.stringify(cart));
}

// Atualiza o nÃºmero de itens mostrado no Ã­cone do carrinho
function updateCartCount() {
  cartCountBadge.textContent = getCart().length;
}

// ---------- Renderiza os produtos na tela ----------
function renderCart() {
  const cart = getCart(); // busca os produtos salvos
  carrinhoGrid.innerHTML = ""; // limpa a Ã¡rea de produtos
  let total = 0; // variÃ¡vel para somar o total

  // Se o carrinho estiver vazio
  if (cart.length === 0) {
    carrinhoGrid.innerHTML = "<p>Seu carrinho estÃ¡ vazio.</p>";
    totalValue.textContent = "0.00";
    finalizarCompraBtn.href = "#";
    return;
  }

  // Percorre cada produto e cria o card na tela
  cart.forEach((produto, index) => {
    // Converte o preÃ§o "R$ 5,00" para nÃºmero 5.00
    const precoNumerico = parseFloat(
      (produto.preco || "0").replace("R$", "").replace(",", ".").trim()
    ) || 0;
    total += precoNumerico;

    // Cria o HTML do card do produto
    const card = document.createElement("div");
    card.className = "card-produto";
    card.innerHTML = `
      <img src="${produto.imgUrl}" alt="${produto.nome}">
      <h3>${produto.nome}</h3>
      <p>${produto.descricao || ''}</p>
      <p>R$ ${precoNumerico.toFixed(2)}</p>
      <button data-index="${index}" class="remover-btn">Remover</button>
    `;
    carrinhoGrid.appendChild(card);
  });

  // Atualiza o valor total exibido
  totalValue.textContent = total.toFixed(2);

  // ---------- BotÃµes de remover ----------
  document.querySelectorAll(".remover-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.getAttribute("data-index");
      let cart = getCart();
      cart.splice(index, 1); // remove o item pelo Ã­ndice
      setCart(cart);         // atualiza o localStorage
      renderCart();          // re-renderiza os produtos
      updateCartCount();     // atualiza o contador
    });
  });

  // ---------- Monta a mensagem do WhatsApp ----------
  const message = cart
    .map(p => `${p.nome} - ${p.preco}`)
    .join("\n") + `\n\nTotal: R$ ${total.toFixed(2)}`;

  const phone = "5511999999999"; // nÃºmero do WhatsApp (com DDI 55)
  finalizarCompraBtn.href = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(message)}`;
}

// ---------- InicializaÃ§Ã£o ----------
renderCart();               // mostra os produtos na tela
updateCartCount();          // mostra o nÃºmero de itens no carrinho
document.getElementById("year").textContent = new Date().getFullYear(); // atualiza o ano no rodapÃ©
</script>

</body>
</html>
