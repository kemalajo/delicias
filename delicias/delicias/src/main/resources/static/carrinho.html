<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delicias Fer Lopes â€” Carrinho</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <img src="img/delicias da fer.png" alt="Delicias da Fer Lopes" class="logo">
      <div class="brand-text">
        <h1>Delicias</h1>
        <small>Fer Lopes</small>
      </div>
    </div>
    <nav class="main-nav">
      <a class="nav-link" href="index.html">InÃ­cio</a>
      <a class="nav-link" href="produtos.html">Produtos</a>
      <a class="nav-link" href="sobre.html">Sobre</a>
      <a class="nav-link active" href="carrinho.html">Carrinho</a>
    </nav>
    <div class="header-actions">
      <a class="phone" href="tel:+5511999999999">ðŸ“ž (15) 99717-2394</a>
      <a class="cart-link" href="carrinho.html">ðŸ›’ <span id="cart-count-badge">0</span></a>
    </div>
  </div>
</header>

<section class="section hero small-hero">
  <div class="container">
    <h2 class="section-title">Carrinho</h2>
    <p class="section-desc">Confira seus produtos selecionados, remova itens ou finalize a compra pelo WhatsApp.</p>
  </div>
</section>

<main class="container produtos-page">
  <div id="carrinhoGrid" class="grid-cardapio"></div>

  <div class="carrinho-footer">
    <h3>Total: R$ <span id="totalValue">0.00</span></h3>
    <a class="btn primary" id="finalizarCompraBtn" href="#" target="_blank">Finalizar Compra</a>
  </div>
</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <div>Â© <span id="year"></span> Delicias Fer Lopes â€” Todos os direitos reservados.</div>
    <div>ðŸ“ž (15) 99717-2394 â€¢ Sorocaba</div>
  </div>
</footer>

<script>
const carrinhoGrid = document.getElementById("carrinhoGrid");
const cartCountBadge = document.getElementById("cart-count-badge");
const totalValue = document.getElementById("totalValue");
const finalizarCompraBtn = document.getElementById("finalizarCompraBtn");

// FunÃ§Ãµes utilitÃ¡rias
function getCart() {
  return JSON.parse(localStorage.getItem("carrinho")) || [];
}

function setCart(cart) {
  localStorage.setItem("carrinho", JSON.stringify(cart));
}

function updateCartCount() {
  cartCountBadge.textContent = getCart().length;
}

function renderCart() {
  const cart = getCart();
  console.log(cart);
  carrinhoGrid.innerHTML = "";
  let total = 0;

  if (cart.length === 0) {
    carrinhoGrid.innerHTML = "<p>Seu carrinho estÃ¡ vazio.</p>";
    totalValue.textContent = "0.00";
    finalizarCompraBtn.href = "#";
    return;
  }

  cart.forEach((produto, index) => {
    // Converter "R$ 5,00" para nÃºmero 5.00
    const precoNumerico = parseFloat(
      (produto.preco || "0").replace("R$", "").replace(",", ".").trim()
    ) || 0;
    total += precoNumerico;

    const card = document.createElement("div");
    card.className = "card-produto";
    card.innerHTML = `
      <img src="${produto.imgUrl}" alt="${produto.nome}">
      <h3>${produto.nome}</h3>
      <p>${produto.descricao || ''}</p>
      <p>R$ ${precoNumerico.toFixed(2)}</p>
      <button data-index="${index}" class="remover-btn">Remover</button>
    `;
    carrinhoGrid.appendChild(card);
  });

  totalValue.textContent = total.toFixed(2);

  // BotÃ£o de remover item
  document.querySelectorAll(".remover-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.getAttribute("data-index");
      let cart = getCart();
      cart.splice(index, 1);
      setCart(cart);
      renderCart();
      updateCartCount();
    });
  });

  // Montar mensagem do WhatsApp
  const message = cart
    .map(p => `${p.nome} - ${p.preco}`)
    .join("\n") + `\n\nTotal: R$ ${total.toFixed(2)}`;

  const phone = "5511999999999"; // nÃºmero do WhatsApp
  finalizarCompraBtn.href = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(message)}`;
}

// InicializaÃ§Ã£o
renderCart();
updateCartCount();
document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>
